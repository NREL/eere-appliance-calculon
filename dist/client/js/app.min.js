/*! eere-appliance-calculon 21-07-2015 */
$(document).ready(function(){var a=$(".form-control"),b=$(".input-group"),c=$("#appliances"),d=$("#watts"),e=$("#hours"),f=$("#days"),g=$("#states"),h=$("#energy"),i=$("#cost"),j=$(".integer-input");applianceTmplSrc=$("#appliance-template").html(),applianceTemplate=Handlebars.compile(applianceTmplSrc),applianceHtml=applianceTemplate(JSON.parse($("#appliance-data").html())),c.append(applianceHtml),c.wrap(function(){var a=$(this).css("height");return'<div style="height: '+a+'" class="fouc-placeholder"></div>'}),c.addClass("selectpicker"),c.removeClass("invisible"),stateTmplSrc=$("#state-template").html(),stateTemplate=Handlebars.compile(stateTmplSrc),stateHtml=stateTemplate(JSON.parse($("#state-data").html())),g.append(stateHtml),g.wrap(function(){var a=$(this).css("height");return'<div style="height: '+a+'" class="fouc-placeholder"></div>'}),g.addClass("selectpicker"),g.removeClass("invisible");var k={url:"http://api.eia.gov/series/",api_key:"4A8DA35AF7501244A974E9603C4FF11B",series_id:"ELEC.PRICE.XX-RES.Q"},l=function(a){b.removeClass("active"),a.addClass("active")},m=function(){console.log("Recalculating");var b=0,c=0,j=!1,k=d.val(),l=e.val(),m=f.val(),n=g.val();a.each(function(){return j=$(this).val()?!0:!1}),j&&(b=k*l*m/1e3,c=Math.round(b*n)/100,h.html(b+" kWh"),i.html("$"+c))},n=function(a){var b=k.series_id.replace("XX",a);return $.ajax({type:"GET",dataType:"json",url:k.url,data:{api_key:k.api_key,series_id:b}})};j.on("change",function(a){a.currentTarget.value=Math.round(a.currentTarget.value)});var o=function(a,b){g.find("option:eq("+b+")").data("subtext","$0."+a+"/kWh"),g.selectpicker("refresh")};g.on("change",function(a){var b,c=a.currentTarget,d=c.selectedIndex,e=c[d],f=e.dataset.stateCode,g=new $.Deferred;e.value?(b=e.value,o(b,d)):(g=n(f),g.done(function(a){b=Math.round(a.series[0].data[0][1]),e.value=b,o(b,d),m()}),g.fail(function(){alert("Error fetching rate data")}))}),$("#appliances").on("change",function(a){console.log("setting watts to ",a.currentTarget.value),d.val(a.currentTarget.value)}),$("#app").on("change",".form-control",function(a){m()}),$("#app").on("focus",".form-control",function(a){var b=$(a.currentTarget).parents(".input-group");l(b)})});